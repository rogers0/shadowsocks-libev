From: Roger Shimizu <rogershimizu@gmail.com>
Date: Wed, 25 May 2016 22:57:14 +0900
Subject: use system library: libcork libcorkipset libev libsodium libudns

autoreconf runs before configure, so it still doesn't have the condition
variable set yet.
Currently remove all system library part for configure.ac and Makefile.am
---
 Makefile.am     | 6 ++----
 configure.ac    | 5 -----
 src/Makefile.am | 5 -----
 3 files changed, 2 insertions(+), 14 deletions(-)

diff --git a/Makefile.am b/Makefile.am
index 06af285..9877e59 100644
--- a/Makefile.am
+++ b/Makefile.am
@@ -1,8 +1,4 @@
-if USE_SYSTEM_SHARED_LIB
 SUBDIRS = src
-else
-SUBDIRS = libcork libipset src
-endif
 
 if ENABLE_DOCUMENTATION
 SUBDIRS += doc
@@ -14,6 +10,8 @@ pkgconfiglibdir = $(libdir)/pkgconfig
 pkgconfiglib_DATA = shadowsocks-libev.pc
 
 EXTRA_DIST = acl Changes completions debian docker rpm README.md
+if !USE_SYSTEM_SHARED_LIB
 EXTRA_DIST += libcork/include libipset/include
 EXTRA_DIST += libipset/src/libipset/map/inspection-template.c.in
 EXTRA_DIST += libipset/src/libipset/set/inspection-template.c.in
+endif
diff --git a/configure.ac b/configure.ac
index c816824..e101a40 100755
--- a/configure.ac
+++ b/configure.ac
@@ -286,11 +286,6 @@ AC_CONFIG_FILES([shadowsocks-libev.pc
                  Makefile
                  src/Makefile])
 
-AM_COND_IF([USE_SYSTEM_SHARED_LIB],
-		   [],
-		   [AC_CONFIG_FILES([libcork/Makefile
-							 libipset/Makefile])])
-
 AM_COND_IF([ENABLE_DOCUMENTATION],
   [AC_CONFIG_FILES([doc/Makefile])
 ])
diff --git a/src/Makefile.am b/src/Makefile.am
index 955fb57..15409d0 100644
--- a/src/Makefile.am
+++ b/src/Makefile.am
@@ -9,12 +9,7 @@ endif
 AM_CFLAGS += $(LIBPCRE_CFLAGS)
 
 SS_COMMON_LIBS = $(INET_NTOP_LIB) $(LIBPCRE_LIBS)
-if !USE_SYSTEM_SHARED_LIB
-SS_COMMON_LIBS += $(top_builddir)/libipset/libipset.la \
-                  $(top_builddir)/libcork/libcork.la
-else
 SS_COMMON_LIBS += -lcork -lcorkipset
-endif
 SS_COMMON_LIBS += -lev -lsodium -lm
 
 bin_PROGRAMS = ss-local ss-tunnel ss-server ss-manager
