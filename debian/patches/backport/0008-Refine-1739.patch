From: Max Lv <max.c.lv@gmail.com>
Date: Wed, 18 Oct 2017 09:29:32 +0800
Subject: Refine #1739

(cherry picked from commit f19a96e1fad1820ad10efba265f1ce772b9d1d53)
---
 src/jconf.c | 3 +++
 1 file changed, 3 insertions(+)

diff --git a/src/jconf.c b/src/jconf.c
index 98942c2..4050fda 100644
--- a/src/jconf.c
+++ b/src/jconf.c
@@ -295,6 +295,8 @@ read_jconf(const char *file)
             } else if (strcmp(name, "mode") == 0) {
                 char *mode_str = to_string(value);
 
+                if (mode_str == NULL)
+                    conf.mode = TCP_ONLY;
                 if (strcmp(mode_str, "tcp_only") == 0)
                     conf.mode = TCP_ONLY;
                 else if (strcmp(mode_str, "tcp_and_udp") == 0)
@@ -304,6 +306,7 @@ read_jconf(const char *file)
                 else
                     LOGI("ignore unknown mode: %s, use tcp_only as fallback",
                          mode_str);
+
                 ss_free(mode_str);
             } else if (strcmp(name, "mtu") == 0) {
                 check_json_value_type(value, json_integer,
